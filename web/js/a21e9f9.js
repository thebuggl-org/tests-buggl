(function(){var v=null;function u(d){return function(e){this[d]=e}}function p(d){return function(){return this[d]}}var o;function m(e,d,j){this.extend(m,google.maps.OverlayView);this.c=e;this.a=[];this.f=[];this.ca=[53,56,66,78,90];this.j=[];this.A=!1;j=j||{};this.g=j.gridSize||60;this.l=j.minimumClusterSize||2;this.J=j.maxZoom||v;this.j=j.styles||[];this.X=j.imagePath||this.Q;this.W=j.imageExtension||this.P;this.O=!0;if(j.zoomOnClick!=void 0){this.O=j.zoomOnClick}this.r=!1;if(j.averageCenter!=void 0){this.r=j.averageCenter}i(this);this.setMap(e);this.K=this.c.getZoom();var h=this;google.maps.event.addListener(this.c,"zoom_changed",function(){var k=h.c.getZoom();if(h.K!=k){h.K=k,h.m()}});google.maps.event.addListener(this.c,"idle",function(){h.i()});d&&d.length&&this.C(d,!1)}o=m.prototype;o.Q="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m";o.P="png";o.extend=function(e,d){return function(j){for(var h in j.prototype){this.prototype[h]=j.prototype[h]}return this}.apply(e,[d])};o.onAdd=function(){if(!this.A){this.A=!0,g(this)}};o.draw=function(){};function i(e){if(!e.j.length){for(var d=0,h;h=e.ca[d];d++){e.j.push({url:e.X+(d+1)+"."+e.W,height:h,width:h})}}}o.S=function(){for(var e=this.o(),d=new google.maps.LatLngBounds,j=0,h;h=e[j];j++){d.extend(h.getPosition())}this.c.fitBounds(d)};o.z=p("j");o.o=p("a");o.V=function(){return this.a.length};o.ba=u("J");o.I=p("J");o.G=function(e,d){for(var k=0,j=e.length,h=j;h!==0;){h=parseInt(h/10,10),k++}k=Math.min(k,d);return{text:j,index:k}};o.$=u("G");o.H=p("G");o.C=function(e,d){for(var j=0,h;h=e[j];j++){b(this,h)}d||this.i()};function b(e,d){d.s=!1;d.draggable&&google.maps.event.addListener(d,"dragend",function(){d.s=!1;e.L()});e.a.push(d)}o.q=function(e,d){b(this,e);d||this.i()};function a(e,d){var k=-1;if(e.a.indexOf){k=e.a.indexOf(d)}else{for(var j=0,h;h=e.a[j];j++){if(h==d){k=j;break}}}if(k==-1){return !1}d.setMap(v);e.a.splice(k,1);return !0}o.Y=function(e,d){var h=a(this,e);return !d&&h?(this.m(),this.i(),!0):!1};o.Z=function(e,d){for(var k=!1,j=0,h;h=e[j];j++){h=a(this,h),k=k||h}if(!d&&k){return this.m(),this.i(),!0}};o.U=function(){return this.f.length};o.getMap=p("c");o.setMap=u("c");o.w=p("g");o.aa=u("g");o.v=function(e){var d=this.getProjection(),j=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),h=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),j=d.fromLatLngToDivPixel(j);j.x+=this.g;j.y-=this.g;h=d.fromLatLngToDivPixel(h);h.x-=this.g;h.y+=this.g;j=d.fromDivPixelToLatLng(j);d=d.fromDivPixelToLatLng(h);e.extend(j);e.extend(d);return e};o.R=function(){this.m(!0);this.a=[]};o.m=function(e){for(var d=0,h;h=this.f[d];d++){h.remove()}for(d=0;h=this.a[d];d++){h.s=!1,e&&h.setMap(v)}this.f=[]};o.L=function(){var d=this.f.slice();this.f.length=0;this.m();this.i();window.setTimeout(function(){for(var e=0,h;h=d[e];e++){h.remove()}},0)};o.i=function(){g(this)};function g(s){if(s.A){for(var q=s.v(new google.maps.LatLngBounds(s.c.getBounds().getSouthWest(),s.c.getBounds().getNorthEast())),n=0,l;l=s.a[n];n++){if(!l.s&&q.contains(l.getPosition())){for(var k=s,z=40000,e=v,y=0,h=void 0;h=k.f[y];y++){var j=h.getCenter();if(j){var d=l.getPosition();if(!j||!d){j=0}else{var t=(d.lat()-j.lat())*Math.PI/180,r=(d.lng()-j.lng())*Math.PI/180,j=Math.sin(t/2)*Math.sin(t/2)+Math.cos(j.lat()*Math.PI/180)*Math.cos(d.lat()*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),j=6371*2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j))}j<z&&(z=j,e=h)}}e&&e.F.contains(l.getPosition())?e.q(l):(h=new D(k),h.q(l),k.f.push(h))}}}}function D(d){this.k=d;this.c=d.getMap();this.g=d.w();this.l=d.l;this.r=d.r;this.d=v;this.a=[];this.F=v;this.n=new C(this,d.z(),d.w())}o=D.prototype;o.q=function(e){var d;e:if(this.a.indexOf){d=this.a.indexOf(e)!=-1}else{d=0;for(var h;h=this.a[d];d++){if(h==e){d=!0;break e}}d=!1}if(d){return !1}if(this.d){if(this.r){h=this.a.length+1,d=(this.d.lat()*(h-1)+e.getPosition().lat())/h,h=(this.d.lng()*(h-1)+e.getPosition().lng())/h,this.d=new google.maps.LatLng(d,h),x(this)}}else{this.d=e.getPosition(),x(this)}e.s=!0;this.a.push(e);d=this.a.length;d<this.l&&e.getMap()!=this.c&&e.setMap(this.c);if(d==this.l){for(h=0;h<d;h++){this.a[h].setMap(v)}}d>=this.l&&e.setMap(v);e=this.c.getZoom();if((d=this.k.I())&&e>d){for(e=0;d=this.a[e];e++){d.setMap(this.c)}}else{if(this.a.length<this.l){w(this.n)}else{d=this.k.H()(this.a,this.k.z().length);this.n.setCenter(this.d);e=this.n;e.B=d;e.ga=d.text;e.ea=d.index;if(e.b){e.b.innerHTML=d.text}d=Math.max(0,e.B.index-1);d=Math.min(e.j.length-1,d);d=e.j[d];e.da=d.url;e.h=d.height;e.p=d.width;e.M=d.textColor;e.e=d.anchor;e.N=d.textSize;e.D=d.backgroundPosition;this.n.show()}}return !0};o.getBounds=function(){for(var e=new google.maps.LatLngBounds(this.d,this.d),d=this.o(),j=0,h;h=d[j];j++){e.extend(h.getPosition())}return e};o.remove=function(){this.n.remove();this.a.length=0;delete this.a};o.T=function(){return this.a.length};o.o=p("a");o.getCenter=p("d");function x(d){d.F=d.k.v(new google.maps.LatLngBounds(d.d,d.d))}o.getMap=p("c");function C(e,d,h){e.k.extend(C,google.maps.OverlayView);this.j=d;this.fa=h||0;this.u=e;this.d=v;this.c=e.getMap();this.B=this.b=v;this.t=!1;this.setMap(this.c)}o=C.prototype;o.onAdd=function(){this.b=document.createElement("DIV");if(this.t){this.b.style.cssText=f(this,c(this,this.d)),this.b.innerHTML=this.B.text}this.getPanes().overlayMouseTarget.appendChild(this.b);var d=this;google.maps.event.addDomListener(this.b,"click",function(){var e=d.u.k;google.maps.event.trigger(e,"clusterclick",d.u);e.O&&d.c.fitBounds(d.u.getBounds())})};function c(e,d){var h=e.getProjection().fromLatLngToDivPixel(d);h.x-=parseInt(e.p/2,10);h.y-=parseInt(e.h/2,10);return h}o.draw=function(){if(this.t){var d=c(this,this.d);this.b.style.top=d.y+"px";this.b.style.left=d.x+"px"}};function w(d){if(d.b){d.b.style.display="none"}d.t=!1}o.show=function(){if(this.b){this.b.style.cssText=f(this,c(this,this.d)),this.b.style.display=""}this.t=!0};o.remove=function(){this.setMap(v)};o.onRemove=function(){if(this.b&&this.b.parentNode){w(this),this.b.parentNode.removeChild(this.b),this.b=v}};o.setCenter=u("d");function f(e,d){var h=[];h.push("background-image:url("+e.da+");");h.push("background-position:"+(e.D?e.D:"0 0")+";");typeof e.e==="object"?(typeof e.e[0]==="number"&&e.e[0]>0&&e.e[0]<e.h?h.push("height:"+(e.h-e.e[0])+"px; padding-top:"+e.e[0]+"px;"):h.push("height:"+e.h+"px; line-height:"+e.h+"px;"),typeof e.e[1]==="number"&&e.e[1]>0&&e.e[1]<e.p?h.push("width:"+(e.p-e.e[1])+"px; padding-left:"+e.e[1]+"px;"):h.push("width:"+e.p+"px; text-align:center;")):h.push("height:"+e.h+"px; line-height:"+e.h+"px; width:"+e.p+"px; text-align:center;");h.push("cursor:pointer; top:"+d.y+"px; left:"+d.x+"px; color:"+(e.M?e.M:"black")+"; position:absolute; font-size:"+(e.N?e.N:11)+"px; font-family:Arial,sans-serif; font-weight:bold");return h.join("")}window.MarkerClusterer=m;m.prototype.addMarker=m.prototype.q;m.prototype.addMarkers=m.prototype.C;m.prototype.clearMarkers=m.prototype.R;m.prototype.fitMapToMarkers=m.prototype.S;m.prototype.getCalculator=m.prototype.H;m.prototype.getGridSize=m.prototype.w;m.prototype.getExtendedBounds=m.prototype.v;m.prototype.getMap=m.prototype.getMap;m.prototype.getMarkers=m.prototype.o;m.prototype.getMaxZoom=m.prototype.I;m.prototype.getStyles=m.prototype.z;m.prototype.getTotalClusters=m.prototype.U;m.prototype.getTotalMarkers=m.prototype.V;m.prototype.redraw=m.prototype.i;m.prototype.removeMarker=m.prototype.Y;m.prototype.removeMarkers=m.prototype.Z;m.prototype.resetViewport=m.prototype.m;m.prototype.repaint=m.prototype.L;m.prototype.setCalculator=m.prototype.$;m.prototype.setGridSize=m.prototype.aa;m.prototype.setMaxZoom=m.prototype.ba;m.prototype.onAdd=m.prototype.onAdd;m.prototype.draw=m.prototype.draw;D.prototype.getCenter=D.prototype.getCenter;D.prototype.getSize=D.prototype.T;D.prototype.getMarkers=D.prototype.o;C.prototype.onAdd=C.prototype.onAdd;C.prototype.draw=C.prototype.draw;C.prototype.onRemove=C.prototype.onRemove})();
var API_KEY;var map;var latLongBounds;function initialize(){drawMap()}function loadScript(){API_KEY=$("#map_canvas").attr("api-key");var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.googleapis.com/maps/api/js?key="+API_KEY+"&sensor=false&callback=initialize";document.body.appendChild(a)}function drawMap(){var a={zoom:16,center:new google.maps.LatLng($("#map_canvas").attr("center-lat"),$("#map_canvas").attr("center-long")),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),a);plotMarkers()}function plotMarkers(){latLongBounds=new google.maps.LatLngBounds();var c=Array();var a;$(".spots").each(function(){var e=$(this);var f=new google.maps.LatLng(e.attr("latitude"),e.attr("longitude"));var d=new google.maps.Marker({position:f,map:map,icon:"/bundles/bugglmain/images/"+e.attr("type")+".png"});d.setMap(map);c.push(d);google.maps.event.addListener(d,"click",function(){if(a){a.close()}a=new google.maps.InfoWindow({content:e.html()});a.open(map,d)});latLongBounds.extend(f)});var b=new MarkerClusterer(map,c);map.fitBounds(latLongBounds)}function resizeMap(){if(typeof google==="object"&&typeof google.maps==="object"){google.maps.event.trigger(map,"resize");map.fitBounds(latLongBounds)}}window.onload=loadScript;