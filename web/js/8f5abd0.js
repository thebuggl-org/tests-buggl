$().ready(function(){var d=window.location.pathname.split("/");var c=(d[1]=="app_dev.php")?"/app_dev.php":"";var b={autocomplete:null,init:function(e){var f=this;var e=$.extend({address:"South Africa"},e);var g=new google.maps.Geocoder();g.geocode(e,function(i,h){var l=i[0].address_components[0].short_name.toLowerCase();var m={componentRestrictions:{country:l}};var k=document.getElementById("google-place-search");(function j(n,o){var p=(n.addEventListener)?n.addEventListener:n.attachEvent;function q(r,s){if(r=="keydown"){var t=s;s=function(w){var u=$(".pac-item.pac-selected").length>0;if(w.which==13&&!u){var v=$.Event("keydown",{keyCode:40,which:40});t.apply(n,[v]);$(".add-city").trigger("click")}t.apply(n,[w])}}p.apply(n,[r,s])}n.addEventListener=q;n.attachEvent=q;f.autocomplete=new google.maps.places.Autocomplete(n,o);google.maps.event.addListener(f.autocomplete,"place_changed",function(){var r=f.autocomplete.getPlace()})})(k,m)})}};function a(){var i={};var g=$("form#guide-info-form");var e=function(){var w={};var x=null;$("#country-search").autocomplete({minLength:2,source:function(B,y){var A=B.term;if(A in w){y(w[A]);return}var z=c+"/ajax/fetch-buggl-countries";if(x!=null){x.abort()}x=$.getJSON(z,B,function(D,C,E){w[A]=D;y(D)})},search:function(y,z){$("#country-search").data("id",0)},select:function(y,z){if(z.item.id==0){$("#country-search").val("");$("#country-search").data("id",z.item.id);return false}t(z.item.label);$("#country-search").data("id",z.item.id)}}).on("blur",function(y){if($(this).val().length>1){t($(this).val())}});if($("#country-search").val().length>0){t($("#country-search").val())}};var t=function(x){if(b.autocomplete!=null){var w=new google.maps.Geocoder();w.geocode({address:x},function(z,y){var A=z[0].address_components[0].short_name.toLowerCase();b.autocomplete.setComponentRestrictions({country:A})})}else{b.init({address:x})}};var l=function(){var x={};var w=null;$("#interests-search").autocomplete({minLength:2,autoFocus:true,select:function(y,z){setTimeout(function(){$(".add-interest").trigger("click")},500)},source:function(B,y){var A=B.term;if(A in x){y(x[A]);return}if(w!=null){w.abort()}var z=c+"/ajax/fetch-interests";w=$.getJSON(z,B,function(D,C,E){x[A]=D;y(D)})}}).keypress(function(y){if(y.keyCode==13){setTimeout(function(){$(".add-interest").trigger("click")},500)}})};var k=function(){var w="teaserTextArea";s(w)};var u=function(){var w="titleTextArea";s(w)};var s=function(y){var x=$("#"+y).attr("data-char-limit");var w=(y=="titleTextArea"?"forecolor":"bold,italic,underline,|,forecolor");$("#"+y).tinymce({script_url:"/bundles/bugglmain/js/tiny_mce/tiny_mce.js",width:"442px",height:"100%",theme:"advanced",plugins:"paste",theme_advanced_buttons1:w,theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_buttons4:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:false,gecko_spellcheck:true,theme_advanced_path:false,handle_event_callback:function(E){if("keydown"==E.type){var C=tinymce.get(y);var J=$(C.getContent()).text();var F=E.keyCode?E.keyCode:E.which;if(F>=37&&F<=40){return true}var B=x;var G=J.length+1;var I=B-J.length;if(F==8||F==46){var A=C.selection.getContent({format:"text"});var z=A.length>0?A.length:1;var D=(J.length==0)?B:parseInt(I)+z;$("#"+y+"-char-count").val(D>B?B:D);return true}else{if(I<=0){$("#"+y+"-char-count").val(0);return false}var H=B-G;$("#"+y+"-char-count").val(H)}}},oninit:function(){var z=tinymce.get(y).getBody();$(z).css({"background-color":"#CCCCCC"});var A=tinymce.get(y);var C=$(A.getContent()).text();var B=x-C.length;$("#"+y+"-char-count").val(B)},paste_preprocess:function(E,D){var A=tinymce.get(y);var C=$(A.getContent()).text();var z=$("<p>"+D.content+"</p>").text();if(C.length+z.length>=x){D.content=z.substring(0,x-C.length);$("#"+y+"-char-count").val(0)}else{D.content=z;var B=x-(C.length+z.length);$("#"+y+"-char-count").val(B)}}})};var o=function(){var w=$("ul.budget",g).find("a");$(w).each(function(){var x=$(this).parent("li:first");$(this).on("hover",function(){},function(){$(x).prevAll().children("a").addClass("hover");$(x).nextAll().children("a").removeClass("hover");$(this).addClass("hover")}).on("click",function(y){y.preventDefault();$(x).prevAll().children("a").removeClass("hover").addClass("active");$(x).nextAll().children("a").removeClass("active");$(this).removeClass("hover").addClass("active");$("input[name='budget']",g).val($(this).data("budget"))})});$("ul.budget").mouseout(function(){$(this).find("a").removeClass("hover")})};var v=function(){var w=$("ul[name='best-time-to-go']",g).find("a");$(w).each(function(){$(this).on("click",function(x){x.preventDefault();$(this).toggleClass("selected");if($(this).hasClass("selected")){$("<input/>",{type:"hidden",name:"best-time-to-go[]",value:$(this).text()}).appendTo($(this).parents("li:first"))}else{$(this).next("input[type='hidden']").remove()}})})};var j=function(){$("div[name='good-for-section']").on("click",":checkbox",function(w){if($("div[name='good-for-section'] :checkbox:checked").length>3){w.preventDefault()}})};var p=function(){var w=$(".eguide-city-list",g);$(".add-city",g).on("click",function(){var x=$("#google-place-search").val();if(0==x.length){return}if(r(x)==false){$("<li/>").addClass("clearfix").appendTo(w);$("<input/>",{type:"hidden",name:"locations[]",value:x}).appendTo($("li:last-child",w));var y='<div class="to-left">'+x+'</div><a class="to-right" href="" name="remove-location">remove</a>';$("ul.eguide-city-list li:last-child").append(y)}$("#google-place-search").focus();$("#google-place-search").select();h()})};var h=function(){$("a[name='remove-location']").unbind("click").on("click",function(w){w.preventDefault();$(this).parent("li").remove()})};var n=function(){var w=$(".eguide-interest-list",g);$(".add-interest",g).on("click",function(){var y=$("#interests-search").val();if(0==y.length){return}if(q(y)==false){$("#interests-search").val("");$("<li/>").addClass("clearfix").appendTo(w);$("<input/>",{type:"hidden",name:"interests[]",value:y}).appendTo($("li:last-child",w));var x='<div class="to-left">'+y+'</div><a class="to-right" href="" name="remove-interest">remove</a>';$("ul.eguide-interest-list li:last-child").append(x)}f()})};var f=function(){$("a[name='remove-interest']").unbind("click").on("click",function(w){w.preventDefault();$(this).parent("li").remove()})};var r=function(w){var x=false;if($("ul.eguide-city-list input[type='hidden']").length>0){$("ul.eguide-city-list input[type='hidden']").each(function(){if($(this).val()==w){x=true;return}})}return x};var q=function(x){var w=false;if($("ul.eguide-interest-list input[type='hidden']").length>0){$("ul.eguide-interest-list input[type='hidden']").each(function(){if($(this).val()==x){w=true;return}})}return w};var m=function(){var x=tinymce.get("teaserTextArea").getContent({format:"text"});var y=tinymce.get("titleTextArea").getContent({format:"text"});var w=true;if($("#country-search",g).val().length==0){$("#country-search-error-msg").css({display:"inline-block"});w=false}if($("input[name='locations[]']",g).length==0){$("#locations-error-msg").css({display:"inline-block"});w=false}if(y.length==0){$("#title-error-msg").css({display:"inline-block"});w=false}if(x.length==0){$("#teaser-error-msg").css({display:"inline-block"});w=false}if($("select[name='trip-theme'] option:selected").val().length==0){$("#trip-theme-error-msg").css({display:"inline-block"});w=false}if($("input[name='interests[]']",g).length==0){$("#interests-error-msg").css({display:"inline-block"});w=false}if($("input[name='good_for[]']:checked",g).length==0){$("#good_for-error-msg").css({display:"inline-block"});w=false}if($("select[name='duration'] option:selected",g).val().length==0){$("#duration-error-msg").css({display:"inline-block"});w=false}if($("input[name='best-time-to-go[]']",g).length==0){$("#best-time-to-go-error-msg").css({display:"inline-block"});w=false}if($("input[name='budget']",g).length==0){$("#budget-error-msg").css({display:"inline-block"});w=false}return w};return{init:function(w){$(".form-field-error").hide();e();l();n();f();k();u();v();j();p();h();$("#guide-info-form-save").on("click",function(x){x.preventDefault();$(".form-field-error").hide();if(m()==true){g.submit()}})}}}var a=new a();a.init()});
(function(a){a.fn.budgetChooser=function(b){var c=a.extend({},a.fn.budgetChooser.defaults,b);a(this).each(function(){var e=this;var d=a(e).find("a");a(d).each(function(){var f=a(this).parent("li:first");a(this).on("hover",function(){},function(){a(f).prevAll().children("a").addClass("hover");a(f).nextAll().children("a").removeClass("hover");a(this).addClass("hover");var g=a(e).find("li.budget-text-value span");g.text(a(this).attr("title"))}).on("click",function(h){h.preventDefault();a(f).prevAll().children("a").removeClass("hover").addClass("active");a(f).nextAll().children("a").removeClass("active");a(this).removeClass("hover").addClass("active");a("input[name='"+c.inputname+"']",a(e).parents("form")).val(a(this).data("budget"));var g=a(e).find("li.budget-text-value span");g.parent("li.budget-text-value").attr("data-text-value",a(this).attr("title"));g.text(a(this).attr("title"))})});a(e).mouseout(function(){a(e).find("a").removeClass("hover");var f=a("li.budget-text-value span",e);f.text(f.parent("li.budget-text-value").attr("data-text-value"))});return e})};a.fn.budgetChooser.defaults={inputname:"budget"}})(jQuery);